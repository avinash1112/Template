# Health and monitoring endpoints
# Included in both HTTP and HTTPS server blocks

# Basic ping endpoint
location __NGINX_CONFIG_PING_PATH__ {
  access_log off;
  add_header Content-Type text/plain;
  return 200 'OK';
}

# Nginx status (internal only)
location __NGINX_CONFIG_STUB_STATUS_PATH__ {
  stub_status;
  allow 127.0.0.1;
  allow ::1;
  deny all;
}

# Kubernetes health endpoints (from health-server.sh)
location /health {
  access_log off;
  try_files /health/health.json =503;
  add_header Content-Type application/json;
}

location /ready {
  access_log off;
  try_files /health/ready.json =503;
  add_header Content-Type application/json;
}

# Additional Kubernetes aliases
location /healthz { 
  access_log off;
  try_files /health/health.json =503;
  add_header Content-Type application/json;
}

location /readiness {
  access_log off; 
  try_files /health/ready.json =503;
  add_header Content-Type application/json;
}

# Instance information endpoint (internal networks only)
location /info {
  access_log off;
  alias /tmp/nodejs/runtime/instance_registration.json;
  add_header Content-Type application/json;
  # Only allow internal access for security
  allow 127.0.0.1;
  allow ::1;
  allow 10.0.0.0/8;
  allow 172.16.0.0/12;
  allow 192.168.0.0/16;
  deny all;
}